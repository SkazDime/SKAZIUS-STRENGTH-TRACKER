<html><head><base href="https://skazdime.github.io/SKAZIUS-STRENGTH-TRACKER/">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#121212">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>Skazius Strength Tracker App</title>
<link rel="manifest" href="manifest.json">
<style>
  body {
    font-family: 'Roboto', sans-serif;
    line-height: 1.6;
    margin: 0;
    padding: 10px;
    background-color: #121212;
    color: #e0e0e0;
    -webkit-tap-highlight-color: transparent;
  }
  .container {
    max-width: 100%;
    margin: 0 auto;
    background-color: #1e1e1e;
    padding: 15px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }
  .logo {
    display: block;
    margin: 0 auto 15px;
    max-width: 100px;
    height: auto;
  }
  h1, h2 {
    color: #0892fc;
    text-align: center;
    text-transform: uppercase;
    letter-spacing: 1px;
    font-size: 1.5em;
    margin-bottom: 15px;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
  }
  input, button, select {
    padding: 12px;
    border: 1px solid #333;
    border-radius: 4px;
    background-color: #2c2c2c;
    color: #e0e0e0;
    font-size: 16px;
    -webkit-appearance: none;
  }
  input:focus, select:focus {
    outline: none;
    border-color: #0892fc;
  }
  button {
    background-color: #0892fc;
    color: #ffffff;
    cursor: pointer;
    transition: background-color 0.3s, transform 0.1s;
    font-weight: bold;
    touch-action: manipulation;
  }
  button:hover, button:focus {
    background-color: #0775d1;
  }
  button:active {
    transform: translateY(1px);
  }
  .set-container {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px;
  }
  .set-container input {
    flex: 1;
  }
  .set-container input[type="text"] {
    flex: 2;
  }
  .remove-set {
    background-color: #cf6679;
    color: #ffffff;
    padding: 8px;
    font-size: 14px;
  }
  .remove-set:hover, .remove-set:focus {
    background-color: #b55464;
  }
  #add-set {
    background-color: #b4fc57;
    color: #121212;
  }
  #add-set:hover, #add-set:focus {
    background-color: #9edf4a;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 20px;
    background-color: #2c2c2c;
    border-radius: 8px;
    overflow: hidden;
  }
  th, td {
    padding: 12px 8px;
    text-align: left;
    border-bottom: 1px solid #444;
    font-size: 14px;
  }
  th {
    background-color: #333;
    color: #0892fc;
    font-weight: bold;
    text-transform: uppercase;
  }
  tr:last-child td {
    border-bottom: none;
  }
  #export-btn {
    background-color: #b4fc57;
    color: #121212;
    margin-top: 10px;
  }
  #export-btn:hover, #export-btn:focus {
    background-color: #9edf4a;
  }
  .time-container {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-bottom: 8px;
  }
  .time-container input {
    flex: 1;
  }
  .superset-container {
    display: flex;
    gap: 8px;
    align-items: center;
    margin-top: 8px;
    padding-left: 20px;
    border-left: 2px solid #0892fc;
  }
  .superset-container input {
    flex: 1;
  }
  .remove-superset {
    background-color: #cf6679;
    color: #ffffff;
    padding: 8px;
    font-size: 14px;
  }
  .remove-superset:hover, .remove-superset:focus {
    background-color: #b55464;
  }
  @media (max-width: 480px) {
    .set-container, .time-container {
      flex-direction: column;
      gap: 5px;
    }
    .set-container input, .set-container button,
    .time-container input {
      width: 100%;
    }
    .superset-container {
      flex-direction: column;
      gap: 5px;
    }
    .superset-container input, .superset-container button {
      width: 100%;
    }
  }
</style>
</head>
<body>
  <div class="container">
    <img src="skaz_green.png" alt="Stylized skull helmet logo in green and black" class="logo" width="100" height="100">
    <h1>Skazius Strength Tracker</h1>
    <form id="exercise-form">
      <input type="date" id="date" required>
      <div class="time-container">
        <input type="time" id="start-time" required>
        <input type="time" id="end-time" required>
      </div>
      <select id="exercise" required>
        <option value="">Select Exercise</option>
        <option value="Bench Press">Bench Press</option>
        <option value="Squat">Squat</option>
        <option value="Deadlift">Deadlift</option>
        <option value="Overhead Press">Overhead Press</option>
        <option value="Barbell Row">Barbell Row</option>
        <option value="other">Other (specify)</option>
      </select>
      <input type="text" id="custom-exercise" placeholder="Custom Exercise Name" style="display: none;">
      <div id="sets-container">
        <!-- Sets will be dynamically added here -->
      </div>
      <button type="button" id="add-set">Add Set</button>
      <button type="submit">Add Exercise</button>
    </form>
    <h2>Exercise Log</h2>
    <table id="exercise-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Exercise</th>
          <th>Sets</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="export-btn">Export to CSV</button>
    <button id="export-txt-btn">Export to TXT</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          }, err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }

    const form = document.getElementById('exercise-form');
    const table = document.getElementById('exercise-table').getElementsByTagName('tbody')[0];
    const exportBtn = document.getElementById('export-btn');
    const exportTxtBtn = document.getElementById('export-txt-btn');
    const addSetBtn = document.getElementById('add-set');
    const setsContainer = document.getElementById('sets-container');
    const exerciseSelect = document.getElementById('exercise');
    const customExerciseInput = document.getElementById('custom-exercise');
    let exercises = JSON.parse(localStorage.getItem('exercises')) || [];

    document.getElementById('date').valueAsDate = new Date();
    document.getElementById('start-time').value = new Date().toTimeString().slice(0,5);

    exerciseSelect.addEventListener('change', function() {
      if (this.value === 'other') {
        customExerciseInput.style.display = 'block';
        customExerciseInput.required = true;
      } else {
        customExerciseInput.style.display = 'none';
        customExerciseInput.required = false;
      }
    });

    function getLastEnteredWeight() {
      const weightInputs = setsContainer.getElementsByClassName('weight');
      return weightInputs.length > 0 ? weightInputs[weightInputs.length - 1].value : '';
    }

    function addSet() {
      const setNumber = setsContainer.children.length + 1;
      const lastWeight = getLastEnteredWeight();
      const setDiv = document.createElement('div');
      setDiv.className = 'set-container';
      setDiv.innerHTML = `
        <input type="number" class="weight" placeholder="Weight for Set ${setNumber} (lbs)" value="${lastWeight}" required>
        <input type="number" class="reps" placeholder="Reps for Set ${setNumber}" required>
        <input type="text" class="notes" placeholder="Notes for Set ${setNumber}">
        <button type="button" class="remove-set" onclick="removeSet(this)">Remove</button>
        <button type="button" class="add-superset" onclick="addSuperset(this)">Add Superset</button>
      `;
      setsContainer.appendChild(setDiv);
    }

    function addSuperset(button) {
      const setContainer = button.parentElement;
      const supersetDiv = document.createElement('div');
      supersetDiv.className = 'superset-container';
      supersetDiv.innerHTML = `
        <input type="text" class="superset-exercise" placeholder="Superset Exercise" required>
        <input type="number" class="superset-weight" placeholder="Weight (lbs)" required>
        <input type="number" class="superset-reps" placeholder="Reps" required>
        <input type="text" class="superset-notes" placeholder="Notes">
        <button type="button" class="remove-superset" onclick="removeSuperset(this)">Remove Superset</button>
      `;
      setContainer.appendChild(supersetDiv);
      button.style.display = 'none';
    }

    function removeSuperset(button) {
      const supersetDiv = button.parentElement;
      const setContainer = supersetDiv.parentElement;
      supersetDiv.remove();
      setContainer.querySelector('.add-superset').style.display = 'inline-block';
    }

    function removeSet(button) {
      if (setsContainer.children.length > 1) {
        button.parentElement.remove();
        updateSetNumbers();
      }
    }

    function updateSetNumbers() {
      const setContainers = setsContainer.getElementsByClassName('set-container');
      for (let i = 0; i < setContainers.length; i++) {
        const weightInput = setContainers[i].getElementsByClassName('weight')[0];
        const repsInput = setContainers[i].getElementsByClassName('reps')[0];
        const notesInput = setContainers[i].getElementsByClassName('notes')[0];
        weightInput.placeholder = `Weight for Set ${i + 1} (lbs)`;
        repsInput.placeholder = `Reps for Set ${i + 1}`;
        notesInput.placeholder = `Notes for Set ${i + 1}`;
      }
    }

    function getFormattedDate() {
      const now = new Date();
      const year = now.getFullYear();
      const month = String(now.getMonth() + 1).padStart(2, '0');
      const day = String(now.getDate()).padStart(2, '0');
      return `${year}-${month}-${day}`;
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const exerciseName = exerciseSelect.value === 'other' ? customExerciseInput.value : exerciseSelect.value;
      const exercise = {
        date: document.getElementById('date').value,
        startTime: document.getElementById('start-time').value,
        endTime: document.getElementById('end-time').value,
        name: exerciseName,
        sets: Array.from(setsContainer.getElementsByClassName('set-container')).map((container, index) => ({
          setNumber: index + 1,
          weight: container.getElementsByClassName('weight')[0].value,
          reps: container.getElementsByClassName('reps')[0].value,
          notes: container.getElementsByClassName('notes')[0].value,
          superset: container.querySelector('.superset-container') ? {
            exercise: container.querySelector('.superset-exercise').value,
            weight: container.querySelector('.superset-weight').value,
            reps: container.querySelector('.superset-reps').value,
            notes: container.querySelector('.superset-notes').value
          } : null
        }))
      };
      exercises.push(exercise);
      localStorage.setItem('exercises', JSON.stringify(exercises));
      renderExercises();
      form.reset();
      document.getElementById('date').valueAsDate = new Date();
      document.getElementById('start-time').value = new Date().toTimeString().slice(0,5);
      setsContainer.innerHTML = '';
      addSet();
      customExerciseInput.style.display = 'none';
    });

    function renderExercises() {
      table.innerHTML = '';
      exercises.forEach((exercise, index) => {
        const row = table.insertRow();
        row.innerHTML = `
          <td>${exercise.date}</td>
          <td>${exercise.startTime}</td>
          <td>${exercise.endTime}</td>
          <td>${exercise.name}</td>
          <td>${exercise.sets.map(set => `
            Set ${set.setNumber}: ${set.weight}lbs x ${set.reps} reps${set.notes ? ` (${set.notes})` : ''}
            ${set.superset ? `<br>Superset: ${set.superset.exercise} - ${set.superset.weight}lbs x ${set.superset.reps} reps${set.superset.notes ? ` (${set.superset.notes})` : ''}` : ''}
          `).join('<br>')}</td>
          <td>
            <button onclick="editExercise(${index})">Edit</button>
            <button onclick="deleteExercise(${index})">Delete</button>
          </td>
        `;
      });
    }

    function editExercise(index) {
      const exercise = exercises[index];
      document.getElementById('date').value = exercise.date;
      document.getElementById('start-time').value = exercise.startTime;
      document.getElementById('end-time').value = exercise.endTime;
      if (exerciseSelect.querySelector(`option[value="${exercise.name}"]`)) {
        exerciseSelect.value = exercise.name;
        customExerciseInput.style.display = 'none';
      } else {
        exerciseSelect.value = 'other';
        customExerciseInput.value = exercise.name;
        customExerciseInput.style.display = 'block';
      }
      setsContainer.innerHTML = '';
      exercise.sets.forEach(set => {
        addSet();
        const lastSet = setsContainer.lastChild;
        lastSet.getElementsByClassName('weight')[0].value = set.weight;
        lastSet.getElementsByClassName('reps')[0].value = set.reps;
        lastSet.getElementsByClassName('notes')[0].value = set.notes || '';
        if (set.superset) {
          addSuperset(lastSet.querySelector('.add-superset'));
          const supersetContainer = lastSet.querySelector('.superset-container');
          supersetContainer.querySelector('.superset-exercise').value = set.superset.exercise;
          supersetContainer.querySelector('.superset-weight').value = set.superset.weight;
          supersetContainer.querySelector('.superset-reps').value = set.superset.reps;
          supersetContainer.querySelector('.superset-notes').value = set.superset.notes || '';
        }
      });
      exercises.splice(index, 1);
      localStorage.setItem('exercises', JSON.stringify(exercises));
      renderExercises();
    }

    function deleteExercise(index) {
      if (confirm('Are you sure you want to delete this exercise?')) {
        exercises.splice(index, 1);
        localStorage.setItem('exercises', JSON.stringify(exercises));
        renderExercises();
      }
    }

    exportBtn.addEventListener('click', () => {
      const flattenedExercises = exercises.flatMap(exercise => 
        exercise.sets.map(set => ({
          date: exercise.date,
          startTime: exercise.startTime,
          endTime: exercise.endTime,
          name: exercise.name,
          setNumber: set.setNumber,
          weight: set.weight,
          reps: set.reps,
          notes: set.notes,
          superset: set.superset ? {
            exercise: set.superset.exercise,
            weight: set.superset.weight,
            reps: set.superset.reps,
            notes: set.superset.notes
          } : null
        }))
      );
      const csv = Papa.unparse(flattenedExercises);
      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      const formattedDate = getFormattedDate();
      link.download = `skazius_strength_data_${formattedDate}.csv`;
      link.click();
    });

    function generateExerciseLogText() {
      let logText = "EXERCISE LOG\n\n";
      exercises.forEach((exercise, index) => {
        logText += `Date: ${exercise.date}\n`;
        logText += `Start Time: ${exercise.startTime}\n`;
        logText += `End Time: ${exercise.endTime}\n`;
        logText += `Exercise: ${exercise.name}\n`;
        logText += "Sets:\n";
        exercise.sets.forEach(set => {
          logText += `  Set ${set.setNumber}: ${set.weight}lbs x ${set.reps} reps`;
          if (set.notes) logText += ` (${set.notes})`;
          logText += "\n";
          if (set.superset) {
            logText += `    Superset: ${set.superset.exercise} - ${set.superset.weight}lbs x ${set.superset.reps} reps`;
            if (set.superset.notes) logText += ` (${set.superset.notes})`;
            logText += "\n";
          }
        });
        logText += "\n";
      });
      return logText;
    }

    exportTxtBtn.addEventListener('click', () => {
      const logText = generateExerciseLogText();
      const blob = new Blob([logText], { type: 'text/plain;charset=utf-8;' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      const formattedDate = getFormattedDate();
      link.download = `skazius_strength_log_${formattedDate}.txt`;
      link.click();
    });

    addSetBtn.addEventListener('click', addSet);

    addSet();
    renderExercises();

    document.addEventListener('gesturestart', function(e) {
      e.preventDefault();
    });
  </script>
</body>
</html>
