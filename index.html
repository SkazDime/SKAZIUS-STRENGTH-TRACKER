<html>
<head>
  <base href="https://skazdime.github.io/SKAZIUS-STRENGTH-TRACKER/">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#121212">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Skazius Strength Tracker App</title>
  <link rel="manifest" href="manifest.json">
  <style>
    /* Add the styles here (no changes) */
  </style>
</head>
<body>
  <div class="container">
    <img src="skaz_green.png" alt="Stylized skull helmet logo in green and black" class="logo" width="100" height="100">
    <h1>Skazius Strength Tracker</h1>
    <form id="exercise-form">
      <input type="date" id="date" required>
      <div class="time-container">
        <input type="time" id="start-time" required>
        <input type="time" id="end-time" required>
      </div>
      <h3>Today's Split</h3>
      <div id="split-container">
        <label><input type="checkbox" name="split" value="chest"> Chest</label>
        <label><input type="checkbox" name="split" value="back"> Back</label>
        <label><input type="checkbox" name="split" value="legs"> Legs</label>
        <label><input type="checkbox" name="split" value="shoulders"> Shoulders</label>
        <label><input type="checkbox" name="split" value="arms"> Arms</label>
      </div>
      <select id="exercise" required>
        <option value="">Select Exercise</option>
        <option value="Bench Press">Bench Press</option>
        <option value="Squat">Squat</option>
        <option value="Deadlift">Deadlift</option>
        <option value="Overhead Press">Overhead Press</option>
        <option value="Barbell Row">Barbell Row</option>
        <option value="other">Other (specify)</option>
      </select>
      <input type="text" id="custom-exercise" placeholder="Custom Exercise Name" class="hidden">
      <div id="sets-container"></div>
      <button type="button" id="add-set">Add Set</button>
      <button type="submit">Add Exercise</button>
    </form>
    <h2>Exercise Log</h2>
    <table id="exercise-table">
      <thead>
        <tr>
          <th>Date</th>
          <th>Start Time</th>
          <th>End Time</th>
          <th>Exercise</th>
          <th>Sets</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <button id="export-btn">Export to CSV</button>
    <button id="export-txt-btn">Export to TXT</button>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
  <script>
    // Service Worker registration logic
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js')
          .then(registration => console.log('Service Worker registered with scope:', registration.scope))
          .catch(err => console.log('Service Worker registration failed:', err));
      });
    }

    const form = document.getElementById('exercise-form');
    const table = document.getElementById('exercise-table').getElementsByTagName('tbody')[0];
    const exportBtn = document.getElementById('export-btn');
    const exportTxtBtn = document.getElementById('export-txt-btn');
    const splitContainer = document.getElementById('split-container');
    const addSetBtn = document.getElementById('add-set');
    const setsContainer = document.getElementById('sets-container');
    const exerciseSelect = document.getElementById('exercise');
    const customExerciseInput = document.getElementById('custom-exercise');
    let exercises = JSON.parse(localStorage.getItem('exercises')) || [];

    document.getElementById('date').valueAsDate = new Date();
    document.getElementById('start-time').value = new Date().toTimeString().slice(0, 5);

    // Add event listener for exercise selection change
    exerciseSelect.addEventListener('change', function () {
      if (this.value === 'other') {
        customExerciseInput.classList.remove('hidden');
        customExerciseInput.required = true;
      } else {
        customExerciseInput.classList.add('hidden');
        customExerciseInput.required = false;
      }
    });

    addSetBtn.addEventListener('click', addSet);

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      const exerciseName = exerciseSelect.value === 'other' ? customExerciseInput.value : exerciseSelect.value;
      const exercise = {
        date: document.getElementById('date').value,
        startTime: document.getElementById('start-time').value,
        endTime: document.getElementById('end-time').value,
        name: exerciseName,
        sets: Array.from(setsContainer.getElementsByClassName('set-container')).map((container, index) => ({
          setNumber: index + 1,
          weight: container.getElementsByClassName('weight')[0].value,
          reps: container.getElementsByClassName('reps')[0].value,
          notes: container.getElementsByClassName('notes')[0].value,
          superset: container.querySelector('.superset-container') ? {
            exercise: container.querySelector('.superset-exercise').value,
            weight: container.querySelector('.superset-weight').value,
            reps: container.querySelector('.superset-reps').value,
            notes: container.querySelector('.superset-notes').value
          } : null
        }))
      };
      exercises.push(exercise);
      localStorage.setItem('exercises', JSON.stringify(exercises));
      renderExercises();
      form.reset();
      document.getElementById('date').valueAsDate = new Date();
      document.getElementById('start-time').value = new Date().toTimeString().slice(0, 5);
      setsContainer.innerHTML = '';
      addSet();
      customExerciseInput.classList.add('hidden');
    });
    function getLastEnteredWeight() {
    const weightInputs = setsContainer.getElementsByClassName('weight');
    return weightInputs.length > 0 ? weightInputs[weightInputs.length - 1].value : '';
}
    function addSet() {
      const setNumber = setsContainer.children.length + 1;
      const lastWeight = getLastEnteredWeight();
      const setDiv = document.createElement('div');
      setDiv.className = 'set-container';
      setDiv.innerHTML = `
        <input type="number" class="weight" placeholder="Weight for Set ${setNumber} (lbs)" value="${lastWeight}" required>
        <input type="number" class="reps" placeholder="Reps for Set ${setNumber}" required>
        <input type="text" class="notes" placeholder="Notes for Set ${setNumber}">
        <button type="button" class="remove-set" onclick="removeSet(this)">Remove</button>
        <button type="button" class="add-superset" onclick="addSuperset(this)">Add Superset</button>
      `;
      setsContainer.appendChild(setDiv);
    }

    // Define other helper functions like addSuperset, removeSet, renderExercises

    addSet(); // Initial set added on page load
    renderExercises(); // Populate the table with exercises if any are in local storage
  </script>
</body>
</html>
